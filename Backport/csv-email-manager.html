<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email CSV Manager for GitHub</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        button:hover {
            background: #005a87;
        }
        .success-btn {
            background: #28a745;
        }
        .success-btn:hover {
            background: #218838;
        }
        .danger-btn {
            background: #dc3545;
        }
        .danger-btn:hover {
            background: #c82333;
        }
        textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            font-size: 12px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        .stat-box {
            text-align: center;
            padding: 15px;
            background: #e9ecef;
            border-radius: 4px;
            flex: 1;
            margin: 0 10px;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #007cba;
        }
        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .csv-preview {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #007cba;
            color: white;
        }
        tr:hover {
            background: #f1f1f1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“§ Email CSV Manager</h1>
        <p class="subtitle">Manage subscriber emails for GitHub repository</p>

        <div class="instructions">
            <strong>ðŸŽ¯ How this works:</strong>
            <ol>
                <li>Emails are collected from your website and stored in localStorage</li>
                <li>Use this page to generate a CSV file</li>
                <li>Save the CSV file to your GitHub repository</li>
                <li>Commit and push to GitHub to keep a permanent record</li>
            </ol>
        </div>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-number" id="totalEmails">0</div>
                <div>Total Emails</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="uniqueEmails">0</div>
                <div>Unique Emails</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="todayEmails">0</div>
                <div>Added Today</div>
            </div>
        </div>

        <div class="section">
            <h2>ðŸ“Š Current Subscribers</h2>
            <div id="csvPreview" class="csv-preview">
                <p>No subscribers yet.</p>
            </div>
        </div>

        <div class="section">
            <h2>ðŸ’¾ Export Options</h2>
            <button onclick="generateCSV()">Generate CSV Content</button>
            <button class="success-btn" onclick="downloadCSV()">Download subscribers.csv</button>
            <button onclick="copyCSV()">Copy CSV to Clipboard</button>
            
            <textarea id="csvContent" placeholder="CSV content will appear here..."></textarea>
            
            <div class="instructions">
                <strong>To save to GitHub:</strong>
                <ol>
                    <li>Click "Download subscribers.csv"</li>
                    <li>Move the file to your Slana repository folder</li>
                    <li>Run: <code>git add subscribers.csv && git commit -m "Update subscribers" && git push</code></li>
                </ol>
            </div>
        </div>

        <div class="section">
            <h2>ðŸ”§ Management Tools</h2>
            <button onclick="loadFromLocalStorage()">Refresh from LocalStorage</button>
            <button onclick="mergeWithExisting()">Merge with Existing CSV</button>
            <button class="danger-btn" onclick="clearLocalStorage()">Clear LocalStorage</button>
        </div>

        <div class="section">
            <h2>ðŸ“¥ Import Existing CSV</h2>
            <input type="file" id="fileInput" accept=".csv">
            <button onclick="importCSV()">Import CSV</button>
        </div>
    </div>

    <script>
        let allSubscribers = [];

        // Load subscribers from localStorage
        function loadFromLocalStorage() {
            const stored = JSON.parse(localStorage.getItem('slana_subscribers') || '[]');
            allSubscribers = stored;
            updateDisplay();
        }

        // Update statistics and preview
        function updateDisplay() {
            // Calculate stats
            const total = allSubscribers.length;
            const uniqueEmails = [...new Set(allSubscribers.map(s => s.email))].length;
            const today = new Date().toDateString();
            const todayCount = allSubscribers.filter(s => 
                new Date(s.timestamp).toDateString() === today
            ).length;

            // Update stats
            document.getElementById('totalEmails').textContent = total;
            document.getElementById('uniqueEmails').textContent = uniqueEmails;
            document.getElementById('todayEmails').textContent = todayCount;

            // Update preview table
            const preview = document.getElementById('csvPreview');
            if (allSubscribers.length === 0) {
                preview.innerHTML = '<p>No subscribers yet.</p>';
            } else {
                let html = '<table><thead><tr><th>Email</th><th>Timestamp</th><th>Date Added</th></tr></thead><tbody>';
                allSubscribers.forEach(sub => {
                    const date = new Date(sub.timestamp);
                    html += `<tr>
                        <td>${sub.email}</td>
                        <td>${sub.timestamp}</td>
                        <td>${date.toLocaleString()}</td>
                    </tr>`;
                });
                html += '</tbody></table>';
                preview.innerHTML = html;
            }
        }

        // Generate CSV content
        function generateCSV() {
            let csv = 'Email,Timestamp,Date Added\n';
            allSubscribers.forEach(sub => {
                const date = new Date(sub.timestamp);
                csv += `${sub.email},${sub.timestamp},"${date.toLocaleString()}"\n`;
            });
            
            document.getElementById('csvContent').value = csv;
            return csv;
        }

        // Download CSV file
        function downloadCSV() {
            const csv = generateCSV();
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'subscribers.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Copy CSV to clipboard
        function copyCSV() {
            const csv = generateCSV();
            navigator.clipboard.writeText(csv).then(() => {
                alert('CSV content copied to clipboard!');
            });
        }

        // Clear localStorage
        function clearLocalStorage() {
            if (confirm('Are you sure you want to clear all stored emails? This cannot be undone!')) {
                localStorage.removeItem('slana_subscribers');
                allSubscribers = [];
                updateDisplay();
                alert('LocalStorage cleared!');
            }
        }

        // Import CSV file
        function importCSV() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a CSV file first');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const lines = text.split('\n').filter(line => line.trim());
                
                // Skip header
                for (let i = 1; i < lines.length; i++) {
                    const parts = lines[i].split(',');
                    if (parts.length >= 2) {
                        allSubscribers.push({
                            email: parts[0].trim(),
                            timestamp: parts[1].trim()
                        });
                    }
                }
                
                // Save to localStorage
                localStorage.setItem('slana_subscribers', JSON.stringify(allSubscribers));
                updateDisplay();
                alert('CSV imported successfully!');
            };
            
            reader.readAsText(file);
        }

        // Merge with existing (remove duplicates)
        function mergeWithExisting() {
            const uniqueEmails = new Map();
            allSubscribers.forEach(sub => {
                if (!uniqueEmails.has(sub.email) || 
                    new Date(sub.timestamp) < new Date(uniqueEmails.get(sub.email).timestamp)) {
                    uniqueEmails.set(sub.email, sub);
                }
            });
            
            allSubscribers = Array.from(uniqueEmails.values());
            localStorage.setItem('slana_subscribers', JSON.stringify(allSubscribers));
            updateDisplay();
            alert('Duplicates removed, keeping earliest timestamps!');
        }

        // Initialize on load
        loadFromLocalStorage();
    </script>
</body>
</html>